<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BELL TARGET SHOOTING</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">  <!-- added -->

  <!-- Google Font (optional offline: remove or self-host) -->
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
    rel="stylesheet"
  />

  <style>
    /* ─── GLOBAL RESET + BASIC SETUP ─────────────────────────────────────────── */
    *{box-sizing:border-box;margin:0;padding:0;font-family:"Poppins",sans-serif;}
    html,body{height:100%;}
    body{
      background:linear-gradient(135deg,#1f2024 0%,#3a416f 100%);
      color:#fafafa;text-align:center;padding:20px;overflow-x:hidden;
    }

    /* ─── MAIN TITLE & SUBTITLE ─────────────────────────────────────────────── */
    #mainTitle{
      font-weight:600;font-size:2.8rem;letter-spacing:2px;color:#00ffd5;
      text-shadow:0 2px 8px rgba(0,255,213,.6);margin-bottom:.2rem;
    }
    #subtitle{
      font-weight:400;font-size:1rem;color:#d1d1d1;margin-bottom:1.2rem;
      font-style:italic;
    }

    /* ─── STATUS LINE ───────────────────────────────────────────────────────── */
    #status{font-size:.95rem;margin-bottom:1em;color:#d1d1d1;}

    /* ─── SCOREBOARD & PLAYER CARDS ─────────────────────────────────────────── */
    #scoreboard{
      display:flex;flex-wrap:wrap;justify-content:center;gap:1rem;margin-bottom:2rem;
    }
    .playerBox{
      position:relative;width:160px;padding:1rem .8rem;
      background:rgba(255,255,255,.08);border:2px solid transparent;border-radius:12px;
      box-shadow:0 4px 10px rgba(0,0,0,.3);cursor:pointer;
      transition:transform .15s ease,border-color .15s ease,background .15s ease;
    }
    .playerBox:hover{transform:translateY(-4px);background:rgba(255,255,255,.12);}
    .playerBox.selected{
      border-color:#00ffd5;background:rgba(0,255,213,.08);
      box-shadow:0 6px 16px rgba(0,255,213,.4);
    }
    .playerBox input[type="text"]{
      width:100%;font-size:1rem;font-weight:600;color:#fff;background:transparent;
      border:none;text-align:center;margin-bottom:.4rem;outline:none;
    }
    .playerBox input::placeholder{color:#ccc;}
    .playerBox .score{
      font-size:2.2rem;font-weight:600;color:#00ffd5;margin-top:.2rem;
      text-shadow:0 1px 4px rgba(0,0,0,.5);
    }
    .deleteBtn{
      position:absolute;top:6px;right:8px;background:none;border:none;color:#ff6b6b;
      font-size:1.1rem;cursor:pointer;transition:color .15s ease;outline:none;
    }
    .deleteBtn:hover{color:#ff3b3b;}

    /* ─── BUTTONS ───────────────────────────────────────────────────────────── */
    button{
      font-family:"Poppins",sans-serif;font-size:1.05rem;font-weight:600;color:#1f2024;
      background:linear-gradient(90deg,#00ffd5 0%,#1affd0 100%);border:none;
      border-radius:8px;padding:.6rem 1.4rem;margin:.5rem;cursor:pointer;
      box-shadow:0 4px 8px rgba(0,0,0,.3);
      transition:transform .15s ease,box-shadow .15s ease;outline:none;
    }
    button:hover:not(:disabled){
      transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.4);
    }
    button:disabled{opacity:.4;cursor:not-allowed;}

    /* ─── LED CIRCLE ────────────────────────────────────────────────────────── */
    #led{
      width:36px;height:36px;background:#444;border-radius:50%;margin:1rem auto 0;
      box-shadow:0 0 8px rgba(0,0,0,.5);
      transition:background-color .1s ease,box-shadow .1s ease;
    }
    #led.active{background:#00ff8c;box-shadow:0 0 12px rgba(0,255,140,.8);}

    /* ─── NEOPIXEL STRIP SIM ───────────────────────────────────────────────── */
    #ledStrip{
      margin:1.5rem auto 0;display:flex;flex-wrap:wrap;justify-content:center;gap:4px;
      width:fit-content;
    }
    .ledPixel{
      width:22px;height:22px;background:#000;border-radius:4px;
      box-shadow:0 0 4px rgba(0,0,0,.5);
      transition:background-color .1s ease,box-shadow .1s ease;
    }
    .ledPixel.on{box-shadow:0 0 12px rgba(255,255,255,.6);}

    /* ─── INFO PANEL ───────────────────────────────────────────────────────── */
    #infoPanel{
      margin-top:2rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,.2);
      max-width:500px;margin-left:auto;margin-right:auto;text-align:left;
      font-size:.9rem;color:#ccc;
    }
    #infoPanel div{margin-bottom:.5rem;}
    #infoPanel label{display:inline-block;width:130px;font-weight:600;color:#fafafa;}
    #infoPanel span{color:#00ffd5;}
  </style>
</head>

<body>
  <h1 id="mainTitle">BELL TARGET SHOOTING</h1>
  <div id="subtitle">by Alex Chavez</div>

  <div id="status">WebSocket closed.</div>

  <div id="scoreboard"></div>

  <div><button id="btnAddPlayer">Add Player</button></div>
  <div><button id="btnHit" disabled>Send Hit</button></div>

  <div><div id="led"></div></div>
  <div id="ledStrip"></div>

  <div id="infoPanel">
    <div><label>Connection:</label><span id="txtConn">Closed</span></div>
    <div><label>Last WS Message:</label><span id="txtLastMsg">—</span></div>
  </div>

<script>
  /* ─── dynamic WebSocket URL ─────────────────────────────────────────────── */
  const WS_URL = `ws://${location.hostname}:81/`;

  /* ─── helpers: sleep & HSV→RGB/HEX ──────────────────────────────────────── */
  function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
  function hsvToRgb(h,s,v){
    const c=v*s,hh=h/60,x=c*(1-Math.abs(hh%2-1));let [r1,g1,b1]=[0,0,0];
    if(hh<1){r1=c;g1=x;} else if(hh<2){r1=x;g1=c;} else if(hh<3){g1=c;b1=x;}
    else if(hh<4){g1=x;b1=c;} else if(hh<5){r1=x;b1=c;} else{r1=c;b1=x;}
    const m=v-c;return{r:Math.round((r1+m)*255),g:Math.round((g1+m)*255),b:Math.round((b1+m)*255)};
  }
  const rgbToHex=(r,g,b)=>`#${[r,g,b].map(x=>x.toString(16).padStart(2,"0")).join("")}`;
  const hsvToHex=h=>rgbToHex(...Object.values(hsvToRgb(h,1,1)));
  const hsvToHexVal=(h,val)=>rgbToHex(...Object.values(hsvToRgb(h,1,val)));

  /* ─── DOM refs & state ──────────────────────────────────────────────────── */
  const scoreboardDiv=document.getElementById("scoreboard");
  const btnAddPlayer=document.getElementById("btnAddPlayer");
  const btnHit=document.getElementById("btnHit");
  const statusDiv=document.getElementById("status");
  const txtConn=document.getElementById("txtConn");
  const txtLastMsg=document.getElementById("txtLastMsg");
  const ledCircle=document.getElementById("led");
  const ledStripDiv=document.getElementById("ledStrip");

  const LED_COUNT=16,ledCells=[];
  let playerCount=0,activeIndex=-1;
  const scores=[],nameInputs=[],scoreSpans=[],playerBoxes=[];

  /* ─── UI helpers (unchanged) ────────────────────────────────────────────── */
  function flashCircleLED(){ledCircle.classList.add("active");setTimeout(()=>ledCircle.classList.remove("active"),200);}
  async function simulateLEDStrip(){ /*  full animation, same as before */ 
    for(let k=0;k<3;k++){
      for(let i=0;i<LED_COUNT;i++){ledCells[i].style.background="#FF0000";ledCells[i].classList.add("on");}
      await sleep(100);
      for(let i=0;i<LED_COUNT;i++){ledCells[i].style.background="#00FF00";}
      await sleep(100);
      for(let i=0;i<LED_COUNT;i++){ledCells[i].style.background="#0000FF";}
      await sleep(100);
      for(let i=0;i<LED_COUNT;i++){ledCells[i].style.background="#000";ledCells[i].classList.remove("on");}
      await sleep(100);
    }
    for(let i=0;i<LED_COUNT;i++){ledCells[i].style.background=hsvToHex(i*360/LED_COUNT);ledCells[i].classList.add("on");await sleep(50);}
    for(let j=0;j<256;j+=5){
      for(let i=0;i<LED_COUNT;i++){
        const hue=((i*360/LED_COUNT)+(j*360/256))%360;
        const bright=(100+80*Math.sin(j*Math.PI/128))/180;
        ledCells[i].style.background=hsvToHexVal(hue,bright);
      } await sleep(20);
    }
    for(let i=0;i<LED_COUNT;i++)ledCells[i].style.background=hsvToHex(i*360/LED_COUNT);
    for(let j=0;j<256;j+=32){
      for(let q=0;q<3;q++){
        for(let i=q;i<LED_COUNT;i+=3){
          ledCells[i].style.background=hsvToHex(((i*360/LED_COUNT)+j)%360);ledCells[i].classList.add("on");
        } await sleep(50);
        for(let i=q;i<LED_COUNT;i+=3){ledCells[i].style.background="#000";ledCells[i].classList.remove("on");}
      }
    }
    const end=Date.now()+3000;let hue=0;
    while(Date.now()<end){
      for(let i=0;i<LED_COUNT;i++){ledCells[i].style.background=hsvToHex(hue);ledCells[i].classList.add("on");}
      await sleep(50);hue=(hue+360*4096/65536)%360;
    }
    for(let i=0;i<LED_COUNT;i++){ledCells[i].style.background="#000";ledCells[i].classList.remove("on");}
  }
  function registerHit(){
    flashCircleLED();
    if(activeIndex>=0&&activeIndex<scores.length){
      scores[activeIndex]++;scoreSpans[activeIndex].textContent=scores[activeIndex];
    }
    simulateLEDStrip();
  }
  function removePlayerAt(idx){
    scoreboardDiv.removeChild(playerBoxes[idx]);
    nameInputs.splice(idx,1);scoreSpans.splice(idx,1);scores.splice(idx,1);playerBoxes.splice(idx,1);
    if(idx<activeIndex)activeIndex--;else if(idx===activeIndex){
      if(scores.length>0){activeIndex=0;playerBoxes[0].classList.add("selected");}
      else{activeIndex=-1;btnHit.disabled=true;}
    }
    if(scores.length>0&&activeIndex<0){activeIndex=0;playerBoxes[0].classList.add("selected");}
    if(scores.length===0){activeIndex=-1;btnHit.disabled=true;}
  }
  function addPlayer(){
    playerCount++;const idx=playerCount-1;
    const box=document.createElement("div");box.className="playerBox";box.id=`playerBox${playerCount}`;
    const del=document.createElement("button");del.className="deleteBtn";del.innerHTML="✕";del.title="Remove this player";box.appendChild(del);
    const name=document.createElement("input");name.type="text";name.id=`playerName${playerCount}`;name.value=`Player ${playerCount}`;name.placeholder=`Player ${playerCount} Name`;box.appendChild(name);
    const score=document.createElement("div");score.className="score";score.id=`score${playerCount}`;score.textContent="0";box.appendChild(score);
    scoreboardDiv.appendChild(box);
    nameInputs.push(name);scoreSpans.push(score);scores.push(0);playerBoxes.push(box);
    if(scores.length===1){activeIndex=0;box.classList.add("selected");btnHit.disabled=false;}
    box.addEventListener("click",e=>{
      if(e.target===del)return;
      if(activeIndex>=0&&activeIndex<playerBoxes.length)playerBoxes[activeIndex].classList.remove("selected");
      activeIndex=Array.from(scoreboardDiv.children).indexOf(box);
      box.classList.add("selected");
    });
    del.addEventListener("click",()=>removePlayerAt(Array.from(scoreboardDiv.children).indexOf(box)));
  }

  /* ─── WebSocket logic ──────────────────────────────────────────────────── */
  let socket=null;
  function connectWebSocket(){
    socket=new WebSocket(WS_URL);
    socket.addEventListener("open",()=>{
      statusDiv.textContent="WebSocket connected!";txtConn.textContent="Connected";if(scores.length>0)btnHit.disabled=false;
    });
    socket.addEventListener("close",()=>{
      statusDiv.textContent="WebSocket closed.";txtConn.textContent="Closed";btnHit.disabled=true;setTimeout(connectWebSocket,2000);
    });
    socket.addEventListener("error",e=>console.warn("WS error:",e));
    socket.addEventListener("message",e=>{
      const msg=e.data.trim();txtLastMsg.textContent=msg;
      if(msg.toLowerCase()==="hit")registerHit();
    });
  }

  /* ─── on page load ─────────────────────────────────────────────────────── */
  window.addEventListener("load",()=>{
    for(let i=0;i<LED_COUNT;i++){
      const pix=document.createElement("div");pix.className="ledPixel";pix.style.background="#000";
      ledStripDiv.appendChild(pix);ledCells.push(pix);
    }
    btnAddPlayer.addEventListener("click",addPlayer);
    btnHit.addEventListener("click",()=>{
      if(socket&&socket.readyState===WebSocket.OPEN){socket.send("hit");txtLastMsg.textContent="➡ hit (sent)";registerHit();}
    });
    btnHit.disabled=true;
    connectWebSocket();
  });
</script>
</body>
</html>
